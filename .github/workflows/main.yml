#name: CI
#
#on:
#  push:
#    branches-ignore:
#      - 'gh-pages'
#
#jobs:
#  build:
#    name: Build site
#    runs-on: ubuntu-latest
#    steps:
#    - uses: actions/checkout@v1
#    - uses: clvx/hugo-action@master
#    - uses: actions/upload-artifact@v1
#      with:
#        name: blog
#        path: public/
#
#  publish:
#    if: github.ref == 'refs/heads/master'
#    name: Publish site
#    runs-on: ubuntu-latest
#    needs: build
#    steps:
#    - uses: actions/checkout@v2
#      with:
#        persist-credentials: false
#    - uses: actions/download-artifact@v1
#      with:
#        name: blog
#    - shell: bash
#      run: |
#        mv blog/* ./ && rmdir blog
#    - uses: webfactory/ssh-agent@v0.4.1
#      with:
#        ssh-private-key: ${{ secrets.DEPLOY_KEY }}
#    - uses: JamesIves/github-pages-deploy-action@releases/v4
#      with:
#        SSH: true
#        BRANCH: gh-pages # The branch the action should deploy to.
#        FOLDER: . # The folder the action should deploy.

name: "CI"
on:
  pull_request:
  push:
jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: cachix/install-nix-action@v27
      with:
        nix_path: nixpkgs=channel:nixos-unstable
    - run: nix-shell shell.nix
    - uses: actions/upload-artifact@v4
      with:
        name: blog
        path: ./public
publish:
  if: github.ref == 'refs/heads/master'
  environment:
    name: github-pages
    #url: ${{ steps.deployment.outputs.page_url }}
  runs-on: ubuntu-latest
  needs: build
  steps:
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4
